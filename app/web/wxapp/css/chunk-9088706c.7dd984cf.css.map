{"version":3,"sources":["webpack:///src/views/F:/wxWeb/wxNewWeb/src/views/src/views/WxAuth.vue","chunk-9088706c.7dd984cf.css"],"names":[],"mappings":"AAgDA,2BACA,iBAAA,CACA,cC9CA","file":"chunk-9088706c.7dd984cf.css","sourcesContent":["<template>\r\n  <div>\r\n      <div class=\"own-auth\">请稍后，登录中...</div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  /**\r\n   * 微信网页授权\r\n   */\r\n  import { setToken } from '../utils/auth'\r\n  export default {\r\n    name: 'wxAuth',\r\n    async created(){\r\n      localStorage.clear();\r\n      // 如果连接中有微信返回的 code，则用此 code 调用后端接口，向微信服务器请求用户信息\r\n      // 如果不是从微信重定向过来的，没有带着微信的 code，则直接进入首页\r\n       if (this.$route.query.code) {\r\n        let res = await this.apis.public.getWxUserInfo({\r\n          code: this.$route.query.code,\r\n          platform: 1\r\n        });\r\n        if (res && res.code === 200) {\r\n          localStorage.setItem('openid', res.data.userInfo.openid);\r\n          this.$store.commit('SET_USERINFO', res.data.userInfo);\r\n          this.$store.commit('SET_TOKEN', res.data.token);\r\n          setToken(res.data.token); // 保存token\r\n          localStorage.setItem('wxUserInfo', JSON.stringify(res.data.userInfo));\r\n          sessionStorage.setItem('wxUserInfo', res.data.userInfo.openid); // 离开页面后在进入需要授权登录\r\n        }\r\n        let redirectUrl = sessionStorage.getItem('wxRedirectUrl');\r\n        this.$router.replace(redirectUrl)\r\n\r\n       /* this.$store.dispatch('loginByCode', { code: this.$route.query.code})\r\n          .then((res) => {\r\n            let redirectUrl = sessionStorage.getItem('wxRedirectUrl');\r\n            this.$router.replace(redirectUrl)\r\n          })\r\n          .catch(() => {\r\n            this.loading = false\r\n          })*/\r\n      } else {\r\n        this.$router.replace('/')\r\n      }\r\n    }\r\n  }\r\n</script>\r\n<style scoped>\r\n  .own-auth{\r\n    text-align: center;\r\n    padding: 20px 0;\r\n  }\r\n</style>","\n.own-auth[data-v-5c908d2f]{\n  text-align: center;\n  padding: 20px 0;\n}\n\n\n/*# sourceMappingURL=chunk-9088706c.7dd984cf.css.map*/"]}